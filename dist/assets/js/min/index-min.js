const textStatic=["Spring comes late to the bog.","Long into April it slumbers, pale and unpeopled.","The grass overgrown in long tussocks, white as chalk, crunching underfoot like snow.","The heather is subdued, almost black, a deep, quiet indigo resting in clusters.","Along the bank the hard stalks of winter grass lie flat, a frosty blue, subtle but shocking in this field, the frozen aftermath of some ancient massacre glinting in the low April sun.","Further towards the western edge burgundy thorns lie across the silver barbed wire fence, one sharp as the other.","Beneath them both, the drain, soft and slow.","On the far side, the exposed roots of the tall, thin trees with few branches and but a little crown of dark green leaves shivering in the breeze.","The roots are caught a muddy red in the late light, like desert sand, like nothing you could believe to be alive.","The roots are out, sunk into the stream and the saturated dirt.","Out in the next crop the birds are gathering and once in a while a pair of wings breaks cover and wheels around the open space, a lap of joyful energy, loud and free against an empty evening sky.","I cast a long shadow and feel uselessly apologetic for every brutish step causing untold harm.","Along the road the sun hangs inches above eye-level and my vision flickers golden in split-second intervals as it streams through the trees.","My steps are hushed here by encircling branches and all around my head the birds, the birds, the birds."];var textArray=[];textArray=textArray.concat(textStatic);var canvas=document.getElementById("canvas");const ctx=canvas.getContext("2d"),wrap=document.getElementById("canvas-wrapper"),v=document.getElementById("video");var img=document.createElement("img");const textWrap=document.getElementById("text-wrapper");var videoArray=[],imageArray=[],globalID;const audio=document.getElementById("c-audio-player"),music=document.getElementById("c-music-player");var audioArray=[],musicArray=[];const text=document.getElementById("text-container"),controlToggle=document.getElementById("controls_toggle"),controlPanel=document.getElementById("controls-wrapper"),opening=document.getElementById("open"),beginButton=document.getElementById("begin"),infoSplash=document.getElementById("info"),infoButton=document.getElementById("info-button"),infoClose=document.getElementById("info-close"),videoSpeedControl=document.getElementById("video_speed"),imageSpeedControl=document.getElementById("photo_speed"),musicVolumeControl=document.getElementById("music_volume"),ambienceVolumeControl=document.getElementById("ambience_volume"),videoToggle=document.getElementById("video_toggle"),photoToggle=document.getElementById("photo_toggle"),musicToggle=document.getElementById("music_toggle"),ambienceToggle=document.getElementById("ambience_toggle"),textToggle=document.getElementById("text_toggle");var videoSpeed=1,imageSpeed=8e3;controlToggle.addEventListener("click",function(){controlPanel.classList.toggle("visible")}),videoSpeedControl.addEventListener("input",function(){videoSpeed=videoSpeedControl.value/50}),videoToggle.addEventListener("change",function(){flip()}),imageSpeedControl.addEventListener("input",function(){imageSpeed=160*imageSpeedControl.value}),photoToggle.addEventListener("change",function(){flip()}),musicVolumeControl.addEventListener("input",function(){music.volume=musicVolumeControl.value}),ambienceVolumeControl.addEventListener("input",function(){audio.volume=ambienceVolumeControl.value}),musicToggle.addEventListener("change",function(){this.checked?""!==music.src?music.play():(musicSet(),musicPlay()):music.pause()}),ambienceToggle.addEventListener("change",function(){this.checked?""!==audio.src?audio.play():(audioSet(),audioPlay()):audio.pause()}),textToggle.addEventListener("change",function(){this.checked?(textWrap.classList.add("visible"),textPick()):textWrap.classList.remove("visible")}),beginButton.addEventListener("click",function(){opening.classList.remove("visible"),videoToggle.checked=!0,photoToggle.checked=!0,ambienceToggle.checked=!0,flip()}),infoButton.addEventListener("click",function(){infoSplash.classList.toggle("visible")}),infoClose.addEventListener("click",function(){infoSplash.classList.remove("visible")});var pos=function(e,t){var o=e.getBoundingClientRect().height,n=e.getBoundingClientRect().width,i=t.getBoundingClientRect().height,a=t.getBoundingClientRect().width,d=i-o,r=a-n,l=Math.floor(Math.random()*d),c=Math.floor(Math.random()*r);l>i/2&&(l-=80),c>a/2&&(c-=40),e.style.top=l+"px",a>960?e.style.left=c+"px":e.style.left="20px"},textPick=function(){var e=Math.floor(Math.random()*textArray.length-1)+1,t=null;t=Math.floor(2*Math.random()),0===t?(textWrap.style.top=text.innerHTML=textArray[e],pos(text,textWrap),setTimeout(textPick,12e3),textArray.length>1?textArray.splice(e,1):textArray=textArray.concat(textStatic)):(text.innerHTML="",setTimeout(textPick,8e3))},audioSet=function(){for(var e=1;29>e;)audioArray.push("assets/audio/bd-audio-"+e++ +".mp3")},audioPick=function(){var e=Math.floor(Math.random()*audioArray.length-1)+1;audio.src=audioArray[e],audioArray.length>0?audioArray.splice(e,1):audioSet()},audioPlay=function(){audioPick(),audio.volume=1,audio.play(),audio.addEventListener("ended",audioPlay)},musicSet=function(){for(var e=1;5>e;)musicArray.push("assets/music/bd-music-"+e++ +".mp3")},musicPick=function(){var e=Math.floor(Math.random()*musicArray.length-1)+1;music.src=musicArray[e],musicArray.length>0?musicArray.splice(e,1):audioSet()},musicPlay=function(){musicPick(),music.play(),music.addEventListener("ended",musicPlay)},draw=function(){img.src="";var e=function(){var e=Math.floor(Math.random()*imageArray.length-1)+1;if(0===imageArray.length){for(var t=1;35>t;)imageArray.push("assets/img/bd-img-"+t++ +".jpg");img.src=imageArray[e]}else img.src=imageArray[e],imageArray.splice(e,1)};e(),img.addEventListener("load",function(){var e=wrap.getBoundingClientRect().width,t=e/1.6;canvas.width=e,canvas.height=t,ctx.drawImage(this,0,0,e,t)})},videoSet=function(){for(var e=1;96>e;)videoArray.push("assets/video/bd-video-"+e++ +".mp4")},videoPick=function(){var e=Math.floor(Math.random()*videoArray.length-1)+1;v.src=videoArray[e],videoArray.length>0?videoArray.splice(e,1):videoSet(),v.volume=0,v.play(),v.addEventListener("ended",flip)},drawVideo=function(){v.playbackRate=videoSpeed;var e=wrap.getBoundingClientRect().width,t=e/1.6;canvas.width=e,canvas.height=t,ctx.drawImage(v,0,0,e,t)},loop=function(){drawVideo(),globalID=requestAnimationFrame(loop)},flip=function(){var e=null;window.cancelAnimationFrame(globalID),v.pause(),ctx.clearRect(0,0,1e3,1e3),videoToggle.checked&&photoToggle.checked&&(e=Math.floor(2*Math.random()),0===e?(draw(),setTimeout(flip,imageSpeed)):(videoPick(),loop())),videoToggle.checked&&!photoToggle.checked&&(videoPick(),loop()),photoToggle.checked&&!videoToggle.checked&&(draw(),setTimeout(flip,imageSpeed)),e=null};videoSet(),document.addEventListener("DOMContentLoaded",function(){musicToggle.checked&&(musicSet(),musicPlay()),ambienceToggle.checked&&(audioSet(),audioPlay()),textToggle.checked&&textPick()});